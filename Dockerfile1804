FROM ubuntu:18.04
LABEL maintainer="ji5489@gmail.com"

ENV DISPLAY=:0 \
    LANG=en_US.UTF-8 \
    LC_ALL=en_US.UTF-8

RUN apt-get -qq update && \
        DEBIAN_FRONTEND=noninteractive apt-get -qq -y install \
            wget ca-certificates locales \
            libx11-xcb1 libxtst6 libnss3 libgtk-3-0 libxss1 lsb-release \
            libcanberra-gtk-module libcanberra-gtk3-module \
            libxshmfence1 libatk-bridge2.0-0 libdrm2 libgbm1 && \
        locale-gen en_US.UTF-8 && update-locale LANG=en_US.UTF-8 && \
    wget -qO /sdkmanager.deb https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/sdkmanager_2.3.0-12617_amd64.deb && \
    /bin/bash -c 'dpkg -i /sdkmanager.deb || true' && rm /sdkmanager.deb &&\
    apt-get -qq update &&\
    apt-get -qq -f -y install &&\
            apt-get -qq -y install sudo &&\
            printf '%s\n%s\n' \
                'ALL ALL=(ALL) NOPASSWD:ALL' \
                'Defaults !authenticate' > /etc/sudoers.d/90-nopasswd && chmod 0440 /etc/sudoers.d/90-nopasswd &&\
    rm -rf /var/lib/apt/lists/* &&\
    useradd nvidia && echo "nvidia:nvidia" | chpasswd && adduser nvidia sudo &&\
    mkdir -p /home/nvidia/Downloads/nvidia && chown -R nvidia:nvidia /home/nvidia

USER nvidia
WORKDIR /home/nvidia

ENTRYPOINT /opt/nvidia/sdkmanager/sdkmanager-gui
